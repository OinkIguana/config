#! /bin/bash

# Based on the script generated by Broot, this one takes the output cmd of Broot
# and then just prints it so it can be recaptured by Kakoune.
f=$(mktemp)
(
    set +e
    broot --outcmd "$f" "$@"
    code=$?
    if [ "$code" != 0 ]; then
        rm -f "$f"
        exit "$code"
    fi
)
code=$?
if [ "$code" != 0 ]; then
    return "$code"
fi
d=$(<"$f")
rm -f "$f"
printf "%s" "$d"
